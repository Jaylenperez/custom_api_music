<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Example of HTML aside Tag</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.5;
            background-color: #FFF;
            font-size: 16px;
            color: #3a3a3a;
        }

        aside {
            width: 25%;
            padding: 6px;
            margin-right: 16px;
            float: left;
        }

        .album-img {
            width: 250px;
            height: 250px;
        }

        .metadata .meta-item {
        margin-right: 0.5rem;
        }

        .metadata .meta-item + .meta-item::before {
        content: "|";
        margin-right: 0.5rem;
        }

    </style>
</head>

<body>
    <h1 id="album-title">
        <span id="album-title-text"> </span>
        <aside>
          <img src="../images/Animal.jpg" class="album-img" alt="Animal Album Cover">
        </aside>
      </h1>
      <p class="metadata">
        <span class="meta-item album">Album</span>
        <span id="release-year" class="meta-item year">Year</span>
        <span id="song-count" class="meta-item count">Song Count</span>
      </p><code><aside></code>
        <table class="table table-dark">
            <tbody id="songs-tbody"></tbody>
        </table>
        <a href="../index.html">← Back to all albums</a>
    </p>

<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
          try {
            // 1) Fetch album metadata
            const resAlbums = await fetch('/data/albums');
            if (!resAlbums.ok) throw new Error(`Albums fetch failed: ${resAlbums.status}`);
            const { albums } = await resAlbums.json();
            if (albums.length === 0) return;
            const album = albums[0];
      
            // 2) Populate title, year & song‑count
            document
              .getElementById('album-title-text')
              .textContent = album.title;
      
            const yearEl = document.getElementById('release-year');
            if (album.release_year) {
              yearEl.textContent = album.release_year;
            } else if (album.release_date) {
              yearEl.textContent = new Date(album.release_date).getFullYear();
            }
      
            const count = album.song_count;
            document
              .getElementById('song-count')
              .textContent = `${count} ${count === 1 ? 'song' : 'songs'}`;
      
            // 3) Fetch all songs, filter for this album
            const resSongs = await fetch('/data/songs');
            if (!resSongs.ok) throw new Error(`Songs fetch failed: ${resSongs.status}`);
            const { songs } = await resSongs.json();
            const albumSongs = songs.filter(s => s.album_id === album.id);
      
            // 4) Render each song into the table
            const tbody = document.getElementById('songs-tbody');
            tbody.innerHTML = '';  // clear any placeholders
      
            albumSongs.forEach(({ track_number, title, duration }) => {
              // turn {hours, minutes, seconds} → "M:SS"
              let durStr;
              if (duration && typeof duration === 'object') {
                const { hours = 0, minutes = 0, seconds = 0 } = duration;
                const totalMin = hours * 60 + minutes;
                const secPadded = String(seconds).padStart(2, '0');
                durStr = `${totalMin}:${secPadded}`;
              } else {
                durStr = duration;
              }
      
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <th scope="row">${track_number}</th>
                <td>${title}</td>
                <td>${durStr}</td>
              `;
              tbody.appendChild(tr);
            });
          } catch (err) {
            console.error('Error loading album page:', err);
          }
        });
      </script>
      
        
      
</body>

</html>
